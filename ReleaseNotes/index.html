<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>Release Notes</title>
		<script src="jira_utils.js"    type="text/javascript"> </script>
		<script src="request_utils.js" type="text/javascript"> </script>
		<script type="text/javascript">
			
			function onPageLoaded()
			{
				RequestUtils.getInstance().request("files/release_notes.json", "GET", onReleseNotesJSONRequestResponse);
			}

			function onReleseNotesJSONRequestResponse(xmlhttp)
			{
				if(RequestUtils.getInstance().checkForValidResponse(xmlhttp))
				{
					//alert("responseText = " + xmlhttp.responseText);

					
					var releaseNotesElement = document.getElementById("ReleaseNotes");
					var releaseNotesData    = JSON.parse(xmlhttp.responseText);

					JiraUtils.getInstance().initialize(releaseNotesData.Settings);

					for(var x = 0; x < releaseNotesData.Versions.length; x++)
					{
						var currentVersion = releaseNotesData.Versions[x];

						addNewVersion(currentVersion, releaseNotesElement);
					}
				}
			}

			function addNewVersion(versionData, releaseNotesElement)
			{
				var newVersionDiv = document.createElement('div');
				newVersionDiv.id  = versionData["Number"];

				var versionNumberDiv 	   = document.createElement('div');
				versionNumberDiv.innerHTML = "<br><br> Version " + versionData["Number"] + ": <br><br>";
				newVersionDiv.appendChild(versionNumberDiv);

				RequestUtils.getInstance().request("files/" + versionData["File"], "GET", 
				function(xmlhttp) { onVersionPlainTextRequestResponse(xmlhttp, newVersionDiv) });

				releaseNotesElement.appendChild(newVersionDiv);
			}

			function onVersionPlainTextRequestResponse(xmlhttp, versionDiv)
			{
				if(RequestUtils.getInstance().checkForValidResponse(xmlhttp))
				{
					var versionTextPlainDiv 	     = document.createElement('textarea');
					versionTextPlainDiv.innerHTML    = "Loading..."
					versionTextPlainDiv.style.width  = "1000px";
					versionTextPlainDiv.style.height = "300px";
					versionDiv.appendChild(versionTextPlainDiv);

					JiraUtils.getInstance().replaceJiraTags(xmlhttp.responseText, function(plainText) 
					{ 
						versionTextPlainDiv.innerHTML = plainText; 
					});
				}
			}

		</script>
	</head>
	<body onload="onPageLoaded();">
		<div id="ReleaseNotes">
		</div>
	</body>
</html>